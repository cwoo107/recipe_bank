<% content_for :title, "Grocery lists" %>

<div class="w-full">

  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4">
    <div>
      <h1 class="text-5xl font-bold tracking-tight text-olive-800 dark:text-[#e8ede3]">Grocery List</h1>
      <p class="mt-2 text-sm text-gray-700 dark:text-gray-400">Grocery List for the week of <%= @date.strftime("%b %d, %Y") %>.</p>
    </div>
    <div class="flex flex-col gap-2">
      <%= button_to generate_grocery_lists_path(date: @date),
                    method: :post,
                    class: "inline-flex items-center gap-x-2 rounded-md bg-[#5f734c] px-3.5 py-2.5 text-sm font-semibold text-white shadow-xs hover:bg-[#4b5a3d] focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#5f734c] dark:bg-[#7a8f62] dark:shadow-none dark:hover:bg-[#5f734c]",
                    data: {
                      turbo_confirm: "This will replace your current grocery list. Continue?"
                    } do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="-ml-0.5 size-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3" />
        </svg>
        Auto generate list
      <% end %>
      <div data-controller="dialog" data-action="click->dialog#backdropClose">
        <dialog data-dialog-target="dialog" class="w-1/2 rounded-lg p-6 shadow-xl backdrop:bg-black/50">
          <%= turbo_frame_tag 'new_grocery_list', src: new_grocery_list_path do %>
          <% end %>
          <div class="mt-4">
            <button type="button" data-action="dialog#close" autofocus class="rounded-lg px-6 py-2.5 bg-gray-200 hover:bg-gray-300 dark:bg-white/10 dark:hover:bg-white/20 text-gray-900 dark:text-white font-medium transition">close</button>
          </div>
        </dialog>

        <button type="button" data-action="dialog#open" class="inline-flex items-center gap-x-2 rounded-md bg-[#5f734c] px-3.5 py-2.5 text-sm font-semibold text-white shadow-xs hover:bg-[#4b5a3d] focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#5f734c] dark:bg-[#7a8f62] dark:shadow-none dark:hover:bg-[#5f734c]">
          <svg viewBox="0 0 20 20" fill="currentColor" class="-ml-0.5 size-5" aria-hidden="true">
            <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
          </svg>
          Add an ingredient
        </button>
      </div>
    </div>
  </div>

  <div class="mt-8">
    <div class="sm:flex sm:items-center sm:justify-between">
      <div class="mb-2">
        <%= link_to grocery_lists_path(date: @date - 1.week),
                    class: "inline-flex items-center gap-x-2 rounded-md bg-[#5f734c] px-3.5 py-2.5 text-sm font-semibold text-white shadow-xs hover:bg-[#4b5a3d] focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#5f734c] dark:bg-[#7a8f62] dark:shadow-none dark:hover:bg-[#5f734c]" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="-ml-0.5 size-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
          </svg>

          Previous Week
        <% end %>
      </div>
      <div class="mb-2">
        <%= link_to grocery_lists_path(date: @date + 1.week),
                    class: "inline-flex items-center gap-x-2 rounded-md bg-[#5f734c] px-3.5 py-2.5 text-sm font-semibold text-white shadow-xs hover:bg-[#4b5a3d] focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#5f734c] dark:bg-[#7a8f62] dark:shadow-none dark:hover:bg-[#5f734c]" do %>
          Next Week
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="-ml-0.5 size-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
          </svg>

        <% end %>
      </div>
    </div>
    <div class="my-2">

      <% @ingredient_families.each do |tag| %>
        <%= link_to grocery_lists_path(filter: tag[:label].downcase) do %>
                <span class="inline-flex items-center rounded-full bg-<%= tag[:color] %>-300 px-2 py-1 text-xs font-medium text-<%= tag[:color] %>-600 inset-ring inset-ring-<%= tag[:color] %>-600/20 dark:bg-<%= tag[:color] %>-800/20 dark:text-<%= tag[:color] %>-300 dark:inset-ring-<%= tag[:color] %>-300/30">
                  <%= tag[:label] %>
                </span>
        <% end %>


      <% end %>
      <% if params[:filter].present? %>
        <%= link_to grocery_lists_path do %>
    <span class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium inset-ring inset-ring-gray-900/10 dark:inset-ring-white/10">
                  clear filter
                </span>
        <% end %>
      <% end %>
    </div>
    <div class="p-4 bg-white shadow-sm inset-ring inset-ring-gray-900/5 sm:rounded-lg dark:bg-white/5 dark:inset-ring-white/10">
      <div role="list" class="divide-y divide-gray-100 dark:divide-white/5">
        <%= turbo_stream_from 'grocery_lists' %>
        <%= render @grocery_lists %>
        <div class="flex justify-between gap-x-6 p-4 bg-[#faf9f7] dark:bg-[#1a1f16]">
          <div class="flex min-w-0 flex-1 gap-x-4 ml-3">
            <div class="min-w-0 flex-auto">
              <p class="text-lg font-bold text-gray-900 dark:text-white">
                Subtotal
              </p>
              <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                Estimated total for <%= @grocery_lists.count %> items
              </p>
            </div>
          </div>

          <div class="shrink-0 flex items-center">
            <p class="text-xl font-bold text-gray-900 dark:text-white">
              <% subtotal = @grocery_lists.sum { |gl| gl.ingredient.unit_price.present? ? (gl.ingredient.unit_price * gl.units) : 0 } %>
              $<%= subtotal.round(2) %>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
