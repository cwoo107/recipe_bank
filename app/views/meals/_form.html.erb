<%= form_with(model: meal, class: "space-y-6")  do |form| %>
  <% if meal.errors.any? %>
    <div id="error_explanation" class="bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 px-4 py-3 font-medium rounded-lg border border-red-200 dark:border-red-800">
      <h2 class="font-semibold mb-2"><%= pluralize(meal.errors.count, "error") %> prohibited this meal from being saved:</h2>
      <ul class="list-disc ml-5 space-y-1 text-sm">
        <% meal.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-4" data-controller="searchable-select" data-searchable-select-placeholder-value="Search for a recipe...">
    <%= form.label :recipe_id, class: "block text-sm font-medium text-gray-900 dark:text-white mb-2" %>
    <%= form.select :recipe_id,
                    options_for_select(
                      Recipe.order(favorite: :desc, title: :asc).map { |r|
                        [r.title, r.id, { 'data-favorite' => r.favorite }]
                      },
                      meal.recipe_id
                    ),
                    { include_blank: true },
                    class: "block w-full rounded-lg bg-white dark:bg-white/5 px-3 py-2.5 text-gray-900 dark:text-white border border-gray-300 dark:border-white/10 focus:border-[#5f734c] dark:focus:border-[#7a8f62] focus:ring-2 focus:ring-[#5f734c]/20 dark:focus:ring-[#7a8f62]/20 outline-none transition",
                    data: {
                      dynamic_filter_target: "field",
                      searchable_select_target: "select",
                      action: "change->dynamic-filter#updateValueField"
                    }
    %>
  </div>


  <div>
    <%= form.label :meal_name, "Meal", class: "block text-sm font-medium text-gray-900 dark:text-white mb-2" %>
    <div class="space-y-2">
      <% [['Breakfast', 'breakfast'], ['Lunch', 'lunch'], ['Dinner', 'dinner']].each do |label, value| %>
        <label class="flex items-center">
          <%= form.radio_button :meal_name,
                                value,
                                required: true,
                                checked: value == 'breakfast' && form.object.meal_name.nil?,
                                style: "accent-color: #5f734c;",
                                class: "h-5 w-5 border-gray-300 focus:ring-[#5f734c] dark:border-gray-600" %>
          <span class="ml-2 text-gray-900 dark:text-white font-semibold "><%= label %></span>
        </label>
      <% end %>
    </div>
  </div>
  <div>
    <%= form.label :date, "Date", class: "block text-sm font-medium text-gray-900 dark:text-white mb-2" %>
    <%= form.date_field :date,
                        required: true,
                        value: Date.today,
                        class: "block w-full rounded-lg bg-white dark:bg-white/5 px-3 py-2.5 text-gray-900 dark:text-white border #{meal.errors[:date].any? ? 'border-red-400 dark:border-red-600 focus:border-red-500 focus:ring-red-500/20' : 'border-gray-300 dark:border-white/10 focus:border-[#5f734c] dark:focus:border-[#7a8f62] focus:ring-[#5f734c]/20 dark:focus:ring-[#7a8f62]/20'} focus:ring-2 outline-none transition" %>
  </div>

  <div class="flex gap-3 pt-4">
    <%= form.submit "Add Meal", class: "rounded-lg px-6 py-2.5 bg-[#5f734c] hover:bg-[#4b5a3d] dark:bg-[#7a8f62] dark:hover:bg-[#5f734c] text-white font-medium cursor-pointer transition shadow-sm" %>
  </div>
<% end %>