<div class="mx-auto max-w-4xl">
  <div class="flex items-start justify-between">
    <div class="min-w-0 flex-1">
      <div class="flex items-center gap-x-3">
        <%= button_to toggle_favorite_ingredient_path(@ingredient),
                      method: :patch,
                      id: "favorite_button_#{@ingredient.id}",
                      data: { turbo: true },
                      class: " px-2 py-2 text-sm font-semibold hover:opacity-80 transition-opacity #{@ingredient.favorite? ? 'text-yellow-500' : 'text-gray-400'}" do %>
          <% if @ingredient.favorite? %>
            <!-- Filled Star -->
            <svg viewBox="0 0 20 20" fill="currentColor" class="size-7" aria-hidden="true">
              <path fill-rule="evenodd" d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z" clip-rule="evenodd" />
            </svg>
          <% else %>
            <!-- Empty Star -->
            <svg viewBox="0 0 20 20" fill="currentColor" class="size-7" aria-hidden="true">
              <path fill-rule="evenodd" d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z" clip-rule="evenodd" />
            </svg>
          <% end %>
        <% end %>

        <h1 class="text-5xl font-bold tracking-tight text-olive-800 dark:text-[#e8ede3]">
          <%= @ingredient.ingredient %>
        </h1>
      </div>

      <div class="mt-2 flex items-center gap-x-4 text-sm text-gray-500 dark:text-gray-400">
        <% if @ingredient.brand.present? %>
      <span class="flex items-center gap-x-1.5">
        <%= @ingredient.brand %>
      </span>
        <% end %>
        <% if @ingredient.family.present? %>
          <%= ingredient_family_tag(@ingredient.family) %>
        <% end %>

        <% if @ingredient.organic? %>
      <span class="inline-flex items-center rounded-full bg-[#e8ede3] px-2 py-1 text-xs font-medium text-[#5f734c] inset-ring inset-ring-[#5f734c]/20 dark:bg-[#7a8f62]/20 dark:text-[#7a8f62] dark:inset-ring-[#7a8f62]/30">
        Organic
      </span>
        <% end %>
      </div>
    </div>

    <div class="ml-4 flex shrink-0 gap-x-3">

      <%= link_to edit_ingredient_path(@ingredient),
                  class: "rounded-md bg-white px-3.5 py-2.5 text-sm font-semibold text-gray-900 shadow-xs inset-ring inset-ring-gray-300 hover:bg-gray-50 dark:bg-white/10 dark:text-white dark:shadow-none dark:inset-ring-white/5 dark:hover:bg-white/20" do %>
        <svg viewBox="0 0 20 20" fill="currentColor" class="-ml-0.5 size-5 inline-block" aria-hidden="true">
          <path d="m5.433 13.917 1.262-3.155A4 4 0 0 1 7.58 9.42l6.92-6.918a2.121 2.121 0 0 1 3 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 0 1-.65-.65Z" />
          <path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0 0 10 3H4.75A2.75 2.75 0 0 0 2 5.75v9.5A2.75 2.75 0 0 0 4.75 18h9.5A2.75 2.75 0 0 0 17 15.25V10a.75.75 0 0 0-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5Z" />
        </svg>
        Edit
      <% end %>

      <%= button_to ingredient_path(@ingredient),
                    method: :delete,
                    data: { turbo_confirm: "Are you sure you want to delete this ingredient?" },
                    class: "rounded-md bg-dusty-rose-600 px-3.5 py-2.5 text-sm font-semibold text-white shadow-xs hover:bg-dusty-rose-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-dusty-rose-600 dark:bg-dusty-rose-500 dark:shadow-none dark:hover:bg-dusty-rose-400" do %>
        Delete
      <% end %>
    </div>
  </div>

  <!-- Nutrition Facts Section -->
  <div class="mt-8">
    <div class="rounded-lg bg-white p-6 shadow-sm inset-ring inset-ring-gray-900/5 dark:bg-white/5 dark:inset-ring-white/10">
      <div class="flex items-center justify-end">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
          $<%= @ingredient.unit_price %> / <%= @ingredient.unit_servings %> servings
        </h2>
      </div>

      <% if @ingredient.nutrition_fact.present? %>
        <div class="mt-6">
          <div class="border-t-8 border-gray-900 dark:border-white">
            <div class="border-b border-gray-900 py-2 dark:border-white">
              <p class="text-3xl font-bold text-gray-900 dark:text-white">Nutrition Facts</p>
            </div>

            <div class="border-b-4 border-gray-900 py-1 dark:border-white">
              <div class="flex justify-between text-sm">
                <span class="font-medium text-gray-900 dark:text-white">Serving size</span>
                <span class="text-gray-900 dark:text-white">
                  <%= @ingredient.nutrition_fact.serving_size %> <%= @ingredient.nutrition_fact.serving_unit %>
                </span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="font-medium text-gray-900 dark:text-white">Calories per serving</span>
                <span class="text-gray-900 dark:text-white">
                  <%= @ingredient.nutrition_fact.calories %> cal
                </span>
              </div>
            </div>

            <div class="space-y-1">
              <div class="flex justify-between border-b border-gray-400 py-1 dark:border-gray-600">
                <span class="font-bold text-gray-900 dark:text-white">Total Fat</span>
                <span class="font-bold text-gray-900 dark:text-white"><%= @ingredient.nutrition_fact.total_fat %>g</span>
              </div>

              <div class="flex justify-between border-b border-gray-400 py-1 dark:border-gray-600">
                <span class="font-bold text-gray-900 dark:text-white">Total Carbohydrate</span>
                <span class="font-bold text-gray-900 dark:text-white"><%= @ingredient.nutrition_fact.total_carb %>g</span>
              </div>

              <div class="flex justify-between border-b-4 border-gray-900 py-1 dark:border-white">
                <span class="font-bold text-gray-900 dark:text-white">Protein</span>
                <span class="font-bold text-gray-900 dark:text-white"><%= @ingredient.nutrition_fact.protein %>g</span>
              </div>
            </div>
          </div>

          <div class="mt-4 flex items-center justify-end gap-x-3">
            <%= link_to "Edit Nutrition Facts", edit_ingredient_nutrition_fact_path(@ingredient, @ingredient.nutrition_fact),
                        class: "text-sm font-medium text-[#5f734c] hover:text-[#4b5a3d] dark:text-[#7a8f62]" %>

            <%= button_to ingredient_nutrition_fact_path(@ingredient, @ingredient.nutrition_fact),
                          method: :delete,
                          data: { turbo_confirm: "Delete nutrition facts?" },
                          class: "text-sm font-medium text-red-600 hover:text-red-500 dark:text-red-400" do %>
              Delete
            <% end %>
          </div>
        </div>
      <% else %>
        <p class="mt-4 text-sm text-gray-500 dark:text-gray-400">No nutrition facts yet. Add them below.</p>
      <% end %>

      <!-- Add Nutrition Facts Form -->
      <% unless @ingredient.nutrition_fact.present? %>
        <div class="mt-6 border-t border-gray-200 pt-6 dark:border-white/10">
          <h3 class="text-base font-semibold text-gray-900 dark:text-white mb-4">Add Nutrition Facts</h3>

          <%= form_with model: [@ingredient, @ingredient.build_nutrition_fact], class: "space-y-4" do |form| %>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <div>
                <%= form.label :serving_size, class: "block text-sm/6 font-medium text-gray-900 dark:text-white" %>
                <%= form.number_field :serving_size,
                                      step: 0.01,
                                      placeholder: "1",
                                      required: true,
                                      class: "mt-2 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-[#5f734c] sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10 dark:focus:outline-[#7a8f62]" %>
              </div>

              <div>
                <%= form.label :serving_unit, class: "block text-sm/6 font-medium text-gray-900 dark:text-white" %>
                <%= form.text_field :serving_unit,
                                    placeholder: "cup",
                                    required: true,
                                    class: "mt-2 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-[#5f734c] sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10 dark:focus:outline-[#7a8f62]" %>
              </div>
            </div>

            <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">
              <div>
                <%= form.label :total_fat, "Total Fat (g)", class: "block text-sm/6 font-medium text-gray-900 dark:text-white" %>
                <%= form.number_field :total_fat,
                                      step: 0.1,
                                      placeholder: "0",
                                      required: true,
                                      class: "mt-2 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-[#5f734c] sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10 dark:focus:outline-[#7a8f62]" %>
              </div>

              <div>
                <%= form.label :total_carb, "Total Carbs (g)", class: "block text-sm/6 font-medium text-gray-900 dark:text-white" %>
                <%= form.number_field :total_carb,
                                      step: 0.1,
                                      placeholder: "0",
                                      required: true,
                                      class: "mt-2 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-[#5f734c] sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10 dark:focus:outline-[#7a8f62]" %>
              </div>

              <div>
                <%= form.label :protein, "Protein (g)", class: "block text-sm/6 font-medium text-gray-900 dark:text-white" %>
                <%= form.number_field :protein,
                                      step: 0.1,
                                      placeholder: "0",
                                      required: true,
                                      class: "mt-2 block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-[#5f734c] sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10 dark:focus:outline-[#7a8f62]" %>
              </div>
            </div>

            <%= form.submit "Add Nutrition Facts",
                            class: "rounded-md bg-[#5f734c] px-3.5 py-2.5 text-sm font-semibold text-white shadow-xs hover:bg-[#4b5a3d] focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#5f734c] dark:bg-[#7a8f62] dark:shadow-none dark:hover:bg-[#5f734c]" %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Used In Recipes -->
  <% if @ingredient.recipe_ingredients.any? %>
    <div class="mt-8">
      <div class="rounded-lg bg-white p-6 shadow-sm inset-ring inset-ring-gray-900/5 dark:bg-white/5 dark:inset-ring-white/10">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Used in Recipes</h2>

        <ul class="mt-4 divide-y divide-gray-200 dark:divide-white/10">
          <% @ingredient.recipe_ingredients.includes(:recipe).each do |recipe_ingredient| %>
            <li class="py-3">
              <%= link_to recipe_path(recipe_ingredient.recipe), class: "flex items-center justify-between group" do %>
                <span class="text-sm font-medium text-gray-900 group-hover:text-[#5f734c] dark:text-white dark:group-hover:text-[#7a8f62]">
                  <%= recipe_ingredient.recipe.title %>
                </span>
                <span class="text-sm text-gray-500 dark:text-gray-400">
                  <%= recipe_ingredient.quantity %> <%= recipe_ingredient.unit %>
                </span>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <div class="mt-8">
    <%= link_to ingredients_path, class: "inline-flex items-center gap-x-1.5 text-sm font-semibold text-gray-900 hover:text-[#5f734c] dark:text-white dark:hover:text-[#7a8f62]" do %>
      <svg viewBox="0 0 20 20" fill="currentColor" class="size-5" aria-hidden="true">
        <path fill-rule="evenodd" d="M17 10a.75.75 0 0 1-.75.75H5.612l4.158 3.96a.75.75 0 1 1-1.04 1.08l-5.5-5.25a.75.75 0 0 1 0-1.08l5.5-5.25a.75.75 0 1 1 1.04 1.08L5.612 9.25H16.25A.75.75 0 0 1 17 10Z" clip-rule="evenodd" />
      </svg>
      Back to ingredients
    <% end %>
  </div>
</div>